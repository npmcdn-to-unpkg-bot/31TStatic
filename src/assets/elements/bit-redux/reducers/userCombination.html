<link rel="import" href="../common.html">
<script>
(() => {
	const EXPORT = {}

	const {
		USER_ADD_FLAVOR,
		USER_REMOVE_FLAVOR,
		USER_SET_RATING,
		USER_SET_COMMENT
	} = window.BIT.Redux.constants.actionTypes

	const {
		combineReducers
	} = window.Redux

	const flavors = (state = [], action) => {
		let index;
		switch (action.type) {
			case USER_ADD_FLAVOR:
				if(state.length >= 3){
					return state
				}
				index = state.indexOf(action.payload)
				if(index !== -1){
					return state
				}
				return [...state, action.payload]
			case USER_REMOVE_FLAVOR:
				if(state.length <= 0){
					return state
				}
				index = state.indexOf(action.payload)
				if(index === -1){
					return state
				}
				const copy = state.slice()
				copy.splice(index, 1)
				return copy
			default:
				return state
		}
	}

	const rating = (state = 0, action) => {
		switch (action.type) {
			case USER_SET_RATING:
				return action.payload
			default:
				return state
		}
	}

	const comment = (state = "", action) => {
		switch (action.type) {
			case USER_SET_COMMENT:
				return action.payload
			default:
				return state
		}
	}

	EXPORT.userCombination = combineReducers({
		flavors,
		rating,
		comment
	})

	window.BIT.Redux.reducers.userCombination = EXPORT
})()
</script>