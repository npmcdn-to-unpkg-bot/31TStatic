<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../bit-core-persistent-store/bit-core-persistent-store.html">
<link rel="import" href="../bit-core-reducer-adder/bit-core-reducer-adder.html">
<link rel="import" href="../bit-core-flavors-loader/bit-core-flavors-loader.html">

<link rel="import" href="../bit-ui-flavor-scroller/bit-ui-flavor-scroller.html">

<dom-module id='bit-app-user'>
	<style></style>
	<template>

		<bit-core-persistent-store
			local-storage-key="bit-app-user">
		</bit-core-persistent-store>

		<bit-core-reducer-adder
			reducers="[[reducers]]">
		</bit-core-reducer-adder>

		<bit-core-flavors-loader>
		</bit-core-flavors-loader>

		<bit-ui-flavor-scroller
			flavors="[[state.flavors]]"
			assets-url="[[rootUrl]]assets/">
		</bit-ui-flavor-scroller>

	</template>
</dom-module>

<script>
(() => {
	const {	reducers } = window.BIT.Redux
	const {
		setApiEndpoint,
		setRootEndpoint,
		setHomeEndpoint } = window.BIT.Redux.actions.endpoints

	class Class {
		beforeRegister() {
			this.is = 'bit-app-user'
			this.properties = {
				apiUrl:{
					type: String,
					observer: '_apiUrlChanged'
				},
				rootUrl:{
					type: String,
					observer: '_rootUrlChanged'
				},
				homeUrl:{
					type: String,
					observer: '_homeUrlChanged'
				},
				reducers:{
					type: Object,
					value: {
						...reducers.flavors,
						...reducers.endpoints
					}
				},
				state:{
					type: Object
				}
			}
		}

		_apiUrlChanged(endpoint){
			this.async(()=>setApiEndpoint(endpoint))
		}
		_rootUrlChanged(endpoint){
			this.async(()=>setRootEndpoint(endpoint))
		}
		_homeUrlChanged(endpoint){
			this.async(()=>setHomeEndpoint(endpoint))
		}
	}
	Polymer(Class);
})();
</script>
